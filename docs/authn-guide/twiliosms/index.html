<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Twilio SMS - Gluu Docs</title>
      
<link href="../../assets/stylesheets/font.css" rel="stylesheet">
      
      
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="Gluu Docs">
    <meta property="og:image" content="None/../../gluu.jpg">
    <meta name="apple-mobile-web-app-title" content="Gluu Docs">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../../gluu.jpg">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-60feabe0e5.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-60feabe0e5.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-f58e216493.css">
    
    <link rel="stylesheet" href="../../assets/stylesheets/zenburn-28d5b94970.css">
    
      
      
      
      <link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto Sans:400,700|Source+Code+Pro">
      <style>
        body, input {
          font-family: 'Noto Sans', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Source Code Pro', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../../assets/javascripts/modernizr-4a5cc7e01e.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                User Authentication Guide <i class="icon icon-link"></i>
              
            
          </span>
        
        Twilio SMS
      </div>
    </div>
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" placeholder="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">

  
  <a href="https://github.com/GluuFederation/docs-3" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../gluu.jpg">
        </div>
      
      <div class="name">
        <strong>Gluu Docs</strong><br>
        version: 3.0.0
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      <ul class="repo">
        
        <li class="home">
          <a href="/" title="Home">
            <div class="home-image">
            <i class="fa fa-home"></i> Doc Home</div>
          </a>
        </li>
        
        
        
        <li class="repo-download">
          
          <a href="https://github.com/GluuFederation/docs-3/archive/3.0.0.zip" target="_blank" title="Download" data-action="download">
            <i class="icon icon-download"></i> Download
          </a>
        </li>
        
      </ul>
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="../..">
      Home
    </a>
    
  </li>
                  
          
            
  <li>
    <span class="section">Installation Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="Preparing VM" href="../../installation-guide/">
      Preparing VM
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Install Gluu Server" href="../../installation-guide/install/">
      Install Gluu Server
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Setup Script Options" href="../../installation-guide/setup_py/">
      Setup Script Options
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
            
  <li>
    <span class="section">Upgrade/Patch Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="Updating oxTrust" href="../../upgrade/update-oxtrustwar/">
      Updating oxTrust
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
            
  <li>
    <span class="section">Operation Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="Release Changes" href="../../operation/intro/">
      Release Changes
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
            
  <li>
    <span class="section">Administration Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="Gluu Server UI" href="../../admin-guide/oxtrust-ui/">
      Gluu Server UI
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="SSO Protocols" href="../../admin-guide/auth-protocol/">
      SSO Protocols
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Authentication Management" href="../../admin-guide/auth-management/">
      Authentication Management
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
            
  <li>
    <span class="section">User Authentication Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="User Authentication Introduction" href="../../admin-guide/user-authentications/">
      User Authentication Introduction
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="U2f" href="../U2F/">
      U2f
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="DUO" href="../DUO/">
      DUO
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="oxPush2-Super Gluu" href="../supergluu/">
      oxPush2-Super Gluu
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="cert" href="../cert-auth/">
      cert
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Google" href="../google/">
      Google
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="current" title="Twilio SMS" href="./">
      Twilio SMS
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Writing a Custom Authentication Script" href="#writing-a-custom-authentication-script">
                <b>Writing a Custom Authentication Script</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Custom Script Location" href="#custom-script-location">
                <b>Custom Script Location</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Suggested Development Environment" href="#suggested-development-environment">
                <b>Suggested Development Environment</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Samples and Documentation" href="#samples-and-documentation">
                <b>Samples and Documentation</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Implement methods - Using Twilio SMS" href="#implement-methods-using-twilio-sms">
                <b>Implement methods - Using Twilio SMS</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Methods" href="#methods">
                <b>Methods</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Saving the value in LDAP and Passing values between two steps" href="#saving-the-value-in-ldap-and-passing-values-between-two-steps">
                <b>Saving the value in LDAP and Passing values between two steps</b>
              </a>
            </li>
            
              <li class="anchor">
              <a title="Saving Values:" href="#saving-values">
                  <font size=2><i>Saving Values:</i></font>
              </a>
            </li>
             
              <li class="anchor">
              <a title="Retriving and passing values between the authentication steps:" href="#retriving-and-passing-values-between-the-authentication-steps">
                  <font size=2><i>Retriving and passing values between the authentication steps:</i></font>
              </a>
            </li>
             
          
            <li class="anchor">
              <a title="Custom Properties" href="#custom-properties">
                <b>Custom Properties</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Returning a message to the user" href="#returning-a-message-to-the-user">
                <b>Returning a message to the user</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Adding Libraries" href="#adding-libraries">
                <b>Adding Libraries</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Testing" href="#testing">
                <b>Testing</b>
              </a>
            </li>
            
          
            <li class="anchor">
              <a title="Reverting Authentication Method" href="#reverting-authentication-method">
                <b>Reverting Authentication Method</b>
              </a>
            </li>
            
          
        </ul>
      
    
  </li>
                  
      
        
  <li>
    <a class="" title="Passport" href="../passport/">
      Passport
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="User Management" href="../../admin-guide/user-group/">
      User Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Log Management" href="../../admin-guide/logs/">
      Log Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="OpenID Clients" href="../../admin-guide/clients/">
      OpenID Clients
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="SAML SSO" href="../../admin-guide/saml/">
      SAML SSO
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="OAuth2 Grants" href="../../admin-guide/oauth2/">
      OAuth2 Grants
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="OpenID Connect" href="../../admin-guide/openid-connect/">
      OpenID Connect
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="UMA" href="../../admin-guide/uma/">
      UMA
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Attribute Management" href="../../admin-guide/attribute/">
      Attribute Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="SCIM protected by UMA" href="../../admin-guide/scim-uma/">
      SCIM protected by UMA
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Gluu Server APIs" href="../../admin-guide/api/">
      Gluu Server APIs
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="SCIM API Configuration" href="../../admin-guide/scim/">
      SCIM API Configuration
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Backup Gluu Server CE" href="../../admin-guide/backup/">
      Backup Gluu Server CE
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Custom Script in Gluu CE" href="../../admin-guide/custom-script/">
      Custom Script in Gluu CE
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Certificate Management" href="../../admin-guide/certificate/">
      Certificate Management
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="FAQ & Troubleshooting" href="../../admin-guide/faq/">
      FAQ & Troubleshooting
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
            
  <li>
    <span class="section">Integration Guide</span>
    <ul>
      
        
  <li>
    <a class="" title="SAML SP" href="../../integration/saml-sp/">
      SAML SP
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="OpenIDC RP" href="../../integration/openidc-rp/">
      OpenIDC RP
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="OXD OAuth2" href="../../integration/oauth2/">
      OXD OAuth2
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Google SSO" href="../../integration/google/">
      Google SSO
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Office 365" href="../../integration/office/">
      Office 365
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Hobsons Education Sol" href="../../integration/hobsons/">
      Hobsons Education Sol
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Salesforce" href="../../integration/salesforce/">
      Salesforce
    </a>
    
  </li>
                  
      
        
  <li>
    <a class="" title="Dropbox" href="../../integration/dropbox/">
      Dropbox
    </a>
    
  </li>
                  
      
    </ul>
  </li>
                  
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="twilio-sms-authentication-otp-using-custom-script">Twilio SMS Authentication - OTP using custom script<a class="headerlink" href="#twilio-sms-authentication-otp-using-custom-script" title="Permanent link">#</a></h1>
<h2 id="writing-a-custom-authentication-script">Writing a Custom Authentication Script<a class="headerlink" href="#writing-a-custom-authentication-script" title="Permanent link">#</a></h2>
<p>In this document we walk through the steps of writing a script to implement OTP authentication using <a href="http://twilio.com">Twilio</a> to send an SMS code for a two-step out-of-band authentication mechanism.</p>
<p>At the end of this tutorial you should have a better understanding of how to write your own custom scripts. For reference, you can review the completed Twilio custom authentication script <a href="../twilio2FA.py">here</a>. </p>
<p>Fields in Custom Script:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td align="left">Name of the Script</td>
</tr>
<tr>
<td>Description</td>
<td align="left">[optional] Description about the script</td>
</tr>
<tr>
<td>Programming Language</td>
<td align="left">Currently Python is supported, In future jscript and Java script might be added</td>
</tr>
<tr>
<td>Level</td>
<td align="left">Authentication Level for the authentication, which determines the security level</td>
</tr>
<tr>
<td>Location Type</td>
<td align="left">Determines the script location. Can be stored in a "File" or could be stored in "LDAP"</td>
</tr>
<tr>
<td>Usage Type</td>
<td align="left">Determines the type of the usage. Web, Native or Both</td>
</tr>
<tr>
<td>Custome Property</td>
<td align="left">Determines the key and value of the custom property, which can added to the authentication to pass the values</td>
</tr>
<tr>
<td>Script Box</td>
<td align="left">Script Box will displayed if Location Type is selected as "File", to enter the path of the script</td>
</tr>
<tr>
<td>Script</td>
<td align="left">Script Box will be displayed when Location Type is selected as "LDAP"</td>
</tr>
</tbody>
</table>
<h2 id="custom-script-location">Custom Script Location<a class="headerlink" href="#custom-script-location" title="Permanent link">#</a></h2>
<p>Custom scripts can either be inserted directly into the Gluu Server interface or you can specify a path to the script. Specifying a path will make script development easier. There is also an option to revert back to a working script if the script is faulty or needs further enhancements. The administrator can select <code>File</code> from the Script Location Type in oxTrust and the file input box will be displayed:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/script_upload_box.png" /></p>
<p>The 'LDAP' option in the Script Location Type can be used to store the script in the LDAP tree once the development is complete. Remember that selecting the <code>LDAP</code> method requires the script to be copied in the input box that appears upon LDAP selection:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/script_in_ldap.png" /></p>
<h2 id="suggested-development-environment">Suggested Development Environment<a class="headerlink" href="#suggested-development-environment" title="Permanent link">#</a></h2>
<p>Gluu Server custom scripts are written in <a href="http://www.jython.org/">Jython</a>. It is recommended to use Eclipse for coding purposes.</p>
<p>Now, create some files:
- A Python file for your script
- One or more XHTML files if you have a custom form for your authentication
- One or more XML files (you'll need one for each XHTML file) that provide some information to the Tomcat server about how to display the XHTML file.</p>
<h2 id="samples-and-documentation">Samples and Documentation<a class="headerlink" href="#samples-and-documentation" title="Permanent link">#</a></h2>
<p>There are many good examples of authentication interception scripts checked into Gluu's<br />
<a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/integrations">oxAuth integrations folder</a>. Also, the respective <code>XHTML</code> and <code>XML</code> files are checked in to the <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/src/main/webapp/auth">auth folder</a>.
The interfaces for the authentication interception can be found in the <a href="http://www.gluu.org/docs/reference/interception-scripts/#authentication">Gluu Documentation</a>.</p>
<p>We used the <a href="https://raw.githubusercontent.com/GluuFederation/oxAuth/master/Server/integrations/basic/BasicExternalAuthenticator.py">Basic Script</a> 
as a template. The <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/src/main/webapp/auth/wikid">Wikid forms</a> were also used as a template since it is required to pass the value of the "code" obtained from Twilio to step 2 of the authentication in order to validate and authenticate the user.</p>
<p>The <a href="https://github.com/GluuFederation/oxAuth/blob/master/Server/integrations/wikid/WikidExternalAuthenticator.py">Wikid authentication</a> script was also looked upon quite a bit for examples on how to process the form.</p>
<h2 id="implement-methods-using-twilio-sms">Implement methods - Using Twilio SMS<a class="headerlink" href="#implement-methods-using-twilio-sms" title="Permanent link">#</a></h2>
<p>Simple example of how to add a custom template and how to pass values between 2 steps of authentication and save the value temporarily for authentication of a user. Our Sample 
<a href="../twilio2FA.py">Twilio script</a></p>
<ol>
<li>Login to Gluu UI</li>
<li>Navigate to "Configuration" on the Menu panel to the left</li>
<li>Select Manage Custom Scripts</li>
<li>Scroll to the end of the page and click on "Add custom script configuration"</li>
<li>Enter the Name, Description, Programming Language (Python will be by default, may be in future Java or JavaSCript will be added)</li>
<li>Select the Level needed to set the security level to.</li>
<li>Select Location Type from the script to be executed.</li>
<li>Select the Usage Type required for the authentication.</li>
<li>Define Custom property which is provided by Twilio and can be noted down from Twilio account page of the signed up user. </li>
<li>Click on Enabled to enable the added custom script.</li>
<li>Scroll down to the end of the update and click on Update button to submit the form. </li>
<li>After the custom script is added, click on Manage Authenticaion on the Menu Panel to left. </li>
<li>Select "Default Authentication Method" tab and change the oxTrust authentication mode to "Twilio" or "Name of the script" from the drop down.</li>
</ol>
<p><strong>Note: All three below custom properties are mandatory for the Twilio Two-Factor Authentication script to work</strong></p>
<ul>
<li>ACCOUNT_SID - Numerical sequence of numbers, to identify the token assigned to the user associated with Twilio.</li>
<li>AUTH TOKEN  - Alphanumerical number provided by Twilio for the account holder to identify the user.</li>
<li>FROM_NUMBER - Number which is either assigned by Twilio or can be a number user provides to send the code from.</li>
</ul>
<p>As shown in the below illustration:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/twilio.png" /></p>
<h2 id="methods">Methods<a class="headerlink" href="#methods" title="Permanent link">#</a></h2>
<p><strong>authenticate():</strong></p>
<p>The most important method to implement is obviously the <code>authenticate</code> method. This is where the main business logic is located for
the authentication workflow. It is possible to switch on the step, with the <code>if (step == 1):</code> statement. In oxAuth, there is no
assumption that step 1 and step 2 happen on the same server, therefore the value stored in the LDAP using a temporarily created attribute and retrieved in step 2. There the step is sent into the <code>authenticate</code> method, which helps to save and retrieve the values whereever required.</p>
<p>Below are few Methods and Libraries used to Save the Value to LDAP and retrieve the values as per the requirement.</p>
<p><strong>random.randit()</strong> 
random.randit("start number",""end number"), Generates the code as per designer or requirements. 
Example: random.randit(10000,99999)</p>
<p><strong>context.set()</strong>
This particular method is obtained from jboss to pass the session attribute value to ldap, by creating a temporary attribute which has limited life time and can be retrieved within the life span, expires and session becomes invalid. Save the value of the code obtained through the code generator method. context.set("Name of the temp attribute", <code>&lt;key&gt;</code>). Where <code>&lt;key&gt;</code> is the value that needs to be stored temporarily in ldap.
Example:
context.set("code",code)</p>
<p><strong>UserService.instance()</strong> 
Gets the user login instance</p>
<p><strong>ServerUtil.getFirstValue():</strong></p>
<p>To access  information from requestParameters in your script with <code>ServerUtil.getFirstValue(requestParameters, &lt;key&gt;)</code> where <code>&lt;key&gt;</code>
specifies the value you want to retrieve, you can also use another method <code>requestParameters.get("&lt;key&gt;")</code>
where <code>&lt;key&gt;</code> specifies the value you want to retrieve .</p>
<p><strong>userService.getUserByAttribute():</strong></p>
<p><code>getUserByAttribute("LDAP Attribute", &lt;key&gt;)</code> method access the information in LDAP and retrieves the value of the attribute comparing the value of the <code>&lt;Key&gt;</code>.
Example:
userService.getUserByAttribute("uid", user_name)</p>
<p><strong>getAttribute():</strong>
To retrieve the value of an attribute from LDAP, getAttribute("LDAP Attribute name") can be used. 
Example:
getAttribute("mobile")</p>
<p><strong>requestParameters.get():</strong>
To retrieve values passed from the form through header can be obtained by using the method requestParameters.get(<code>&lt;key&gt;</code>). This will retrieve the values from the form via header and can be stored in a string. Where <code>&lt;key&gt;</code> is the value to be retrieved from header.
Example:
abc = requestParameters.get("passcode")[0].strip()</p>
<p><strong>getCountAuthenticationSteps():</strong></p>
<p>Another method usually needed to implement is <code>getCountAuthenticationSteps</code>. This method normally just returns 1, 2, or 3. If implementing an adaptive authentication strategy,
where the number of steps depends on the context. Check out the
Duo script for a good example of this. In our sample 
<a href="../DuoExternalAuthenticator.py">Duo script</a>,</p>
<p>Duo Script was scripted only for those who wanted to use Duo
for the IT group. So this was checked for group membership, and dynamically adjusted the number of steps. And this can be scripted for any logic or attribute to the check the authentication, like "country" or "region".</p>
<p><strong>getExtraParametersForStep():</strong></p>
<p>If required to save session variables between steps, use the <code>getExtraParametersForStep</code> method. The Gluu Server persists
these variables in LDAP in able to support stateless clustered two
step authentications.</p>
<p><strong>getPageForStep():</strong></p>
<p>If required to display a special Web page for an interactive
login, (or even a custom first page) you'll need to implement the
<code>getPageForStep</code> which specifies the page you want to return for a given
step.</p>
<p><strong>session_attributes.get():</strong>
The attribute value that are saved by the session using context.set. This method is derived from the oxauth core java libraries and called using the SessionState parameters which is defined in the code or programme.
session_attributes.get(<code>&lt;key&gt;</code>), where <code>&lt;key&gt;</code> is the session atribute value that is stored in the ldap.
Example:
session_attributes.get("code")</p>
<h2 id="saving-the-value-in-ldap-and-passing-values-between-two-steps">Saving the value in LDAP and Passing values between two steps<a class="headerlink" href="#saving-the-value-in-ldap-and-passing-values-between-two-steps" title="Permanent link">#</a></h2>
<h3 id="saving-values">Saving Values:<a class="headerlink" href="#saving-values" title="Permanent link">#</a></h3>
<p><strong>context.set</strong> can be used to save values of the required key to an attribute temporarily and the created temporary attribute will be alive only for limited time and expires and gets removed, by that way, adding new attribute to the user is not messed up. And also the expired attribute kills the validity of the session and becomes invalid.</p>
<h3 id="retriving-and-passing-values-between-the-authentication-steps">Retriving and passing values between the authentication steps:<a class="headerlink" href="#retriving-and-passing-values-between-the-authentication-steps" title="Permanent link">#</a></h3>
<p>Using <strong>session_attribute.get()</strong> method, stored session attribute could be retrieved anywhere between the authentication method, by that way the values can be passed between two authentication methods for verification and validation.
Generated code and the entered "code" in the form can be verified using a simple if and the "code" from the form can be obtained using the requestParameters.get() method or serviceUtil.getFirstValue() method.</p>
<h2 id="custom-properties">Custom Properties<a class="headerlink" href="#custom-properties" title="Permanent link">#</a></h2>
<p>Sometimes it is helpful to enable system administrators to
enter properties that might change a lot. If administrators are
not allowed to modify the script, Custom Property feature can be used, as illustrated in below screenshot:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/07-custom-properties.jpg" /></p>
<p>configurationAttributes.get("<key>").getValue2"():</p>
<p>To access this information in your script with 
<code>configurationAttributes.get("&lt;key&gt;").getValue2()</code>
where <code>&lt;key&gt;</code> specifies the value you want to retrieve.</p>
<h2 id="returning-a-message-to-the-user">Returning a message to the user<a class="headerlink" href="#returning-a-message-to-the-user" title="Permanent link">#</a></h2>
<p>It is possible to use the Context to return a message to the
user, which could be especially useful if an error occurs, or if
required to have some kind of user action.</p>
<h2 id="adding-libraries">Adding Libraries<a class="headerlink" href="#adding-libraries" title="Permanent link">#</a></h2>
<p>Pure Python libraries, can be added to <code>/opt/tomcat/conf/python</code>, jar files can be added to <code>/var/gluu/webapps/oxauth/libs</code>.</p>
<p><strong>Note:</strong> jar files should be added within chroot. And not in the main <code>/var/</code> of the system.</p>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">#</a></h2>
<p>When the scripting is done, you can test the script by print
the statments to oxtrust.log under <code>/opt/gluu/jetty/identity/oxtrust.log</code>. </p>
<p>And by prefix the logs, will help to find the script at ease
using tail command <code>tail -f | grep &lt;prefix&gt;</code>, the prefix logs will
provide the script output while one trys to login using the script.</p>
<p>In the Twilio test script, a specific method called
<code>printOut</code> has been scripted to make it easier to add this prefix.</p>
<p>Also, remember that putting all the code in a <code>try / catch</code>
is a good practice to avoid unhandled exceptions. Since during
debugging, those exception may provide a hint pointing what causes the issue.</p>
<p>Further logs to debug and monitor the sequence can be done using oxauth_script.log and oxauth.log
under<code>/opt/tomcat/logs/</code> which is within the chroot.</p>
<h2 id="reverting-authentication-method">Reverting Authentication Method<a class="headerlink" href="#reverting-authentication-method" title="Permanent link">#</a></h2>
<p>It is not unlikely that one may get locked out of Gluu
Server, while testing the authentication script.</p>
<p>If there is any problem in it. In such a case the following
method can be used to revert back the older authentication method. </p>
<p>As a secondary option, InPrivate or Incognito or Private Browser from various Browsers can be used.</p>
          <aside class="copyright" role="note">
           Built with 
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a> using
            <a href="http://gitlab.testbird.io:8099/frontend/testbird-mkdocs-theme.git" target="_blank">
              testBird-mkdocs-theme
            </a> <br>
            
            Copyright &copy; 2016, Gluu, Inc.
            
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../google/" title="Google">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Google
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../passport/" title="Passport">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Passport
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = '';
    </script>
    <script src="../../assets/javascripts/application-ce3999cf34.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    
  </body>
</html>